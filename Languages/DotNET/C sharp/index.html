<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>C Sharp - KaiDocs</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "C Sharp", url: "#_top", children: [
              {title: "MySql in Sharp", url: "#mysql-in-sharp" },
              {title: "\u8981\u5148\u88ddMySql.Data", url: "#mysqldata" },
              {title: "\u53d6table names", url: "#table-names" },
              {title: "Dapper", url: "#dapper" },
              {title: "\u6a94\u6848\u8b80\u53d6", url: "#_1" },
              {title: "\u7db2\u8def\u82b3\u9130", url: "#_5" },
              {title: "Nlog", url: "#nlog" },
              {title: "System.ServiceModel Configuration", url: "#systemservicemodel-configuration" },
              {title: "Configs", url: "#configs" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../C%23%20Garbage%20Collection/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../C%23%20Garbage%20Collection/" class="btn btn-xs btn-link">
        C# Garbage Collection
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../../Information%20Security/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../../Information%20Security/" class="btn btn-xs btn-link">
        Information Security
      </a>
    </div>
    
  </div>

    

    <h1 id="c-sharp">C Sharp</h1>
<h2 id="mysql-in-sharp">MySql in Sharp</h2>
<h2 id="mysqldata">要先裝MySql.Data</h2>
<p><img alt="mysql" src="/_assets/ccharp_mysql.png" /></p>
<h2 id="table-names">取table names</h2>
<pre><code class="c#">private static List&lt;string&gt; GetTables(string dataBase, MySqlConnection conn)
{
    List&lt;string&gt; tableNames = new List&lt;String&gt;();
    string query = &quot;show tables from &quot; + dataBase;
    MySqlCommand command = new MySqlCommand(query, conn);
    using (MySqlDataReader reader = command.ExecuteReader())
    {
        while (reader.Read())
        {
            tableNames.Add(reader.GetString(0));
        }
    }
    //foreach (var t in tableNames)
    //    Console.WriteLine(t);

    return tableNames;
}
</code></pre>

<h2 id="dapper">Dapper</h2>
<p>有一個DB長這樣</p>
<p><img alt="db" src="/_assets/dapper_sample.png" /></p>
<p>只要先這樣</p>
<pre><code class="c#">using Dapper;
</code></pre>

<p>再這樣</p>
<pre><code class="c#">public class hostlist
{
    public int? MallId { get; set; }
    public string Host { get; set; }
    public string MallName { get; set; }
}
</code></pre>

<p>然後這樣</p>
<pre><code class="c#">using Dapper;
using MySql.Data.MySqlClient;
</code></pre>

<pre><code class="c#">string constring = &quot;server=n126;user=root;pwd=scupio;database=bwse_cloud;&quot;;
List&lt;hostlist&gt; hlist = new List&lt;hostlist&gt;();
using (MySqlConnection conn = new MySqlConnection(constring))
{
    conn.Open();
    hlist = conn.Query&lt;hostlist&gt;(@&quot;SELECT * FROM hostlist&quot;).ToList();
}
</code></pre>

<p>就能讀取了，94這麼簡單。<br />
注意資料class的member需要是property且query內不能加上’會出錯(ex: " SELECT * FROM ‘hostlist’ ”)</p>
<p>不預先定義class而使用<code>dynamic</code>取得資料</p>
<pre><code class="c#">dynamic data;
using (var connectionhost = new MySqlConnection(mysqlconnection))
{
    connectionhost.Open();
    data = connectionhost.Query&lt;dynamic&gt;(@&quot;SELECT createTime, actType, versionid FROM versionhistory WHERE createtime = (SELECT MAX(createtime) FROM versionhistory)&quot;).First();
}

lastindextime = data.createTime;
isRebuild = data.actType;
</code></pre>

<p>注意reflaction使用的是你query string的字串，所以兩者要對得上，例如<code>SELECT createTime,...</code>結果後面變成<code>lastindextime = data.createtime;</code>就會錯誤。</p>
<h2 id="_1">檔案讀取</h2>
<h3 id="_2">執行路徑</h3>
<pre><code class="c#">AppDomain.CurrentDomain.BaseDirectory
</code></pre>

<p>or</p>
<pre><code class="c#">Environment.CurrentDirectory
</code></pre>

<h3 id="_3">路徑不存在則建立</h3>
<pre><code class="c#">string dir = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, &quot;HotTermsList&quot;);
if (Directory.Exists(dir) == false)
    Directory.CreateDirectory(dir);
</code></pre>

<h3 id="_4">取特定檔名檔案</h3>
<pre><code class="c#">FileInfo[] files = new DirectoryInfo(System.Environment.CurrentDirectory).GetFiles();
foreach (FileInfo fi in files)
{
    Console.WriteLine(&quot;N: &quot; + fi.Name);

    if (Regex.IsMatch(fi.Name, &quot;NewBehaviorResult&quot;))
    {
        Console.WriteLine(&quot;Match!&quot; + fi.FullName);
    }
}
</code></pre>

<h2 id="_5">網路芳鄰</h2>
<pre><code class="c#">Minimod.Impersonator.Impersonator

private class FileAccessDir
{
    public string FullPath;
    public string loginUser;
    public string loginPassword;
    public string loginDomain;

    public FileAccessDirImp DoImpersonate()
    {
        var r = new FileAccessDirImp();

        if (string.IsNullOrEmpty(loginPassword) == false)
            r.imp = new Minimod.Impersonator.Impersonator(loginUser, loginDomain, loginPassword);

        return r;
    }
}

public class FileAccessDirImp : IDisposable
{
    public Minimod.Impersonator.Impersonator imp = null;

    public void Dispose()
    {
        if (imp != null)
        {
            imp.Dispose();
            imp = null;
        }
    }
}
</code></pre>

<h2 id="nlog">Nlog</h2>
<p>安裝</p>
<ul>
<li>Nlog</li>
<li>Nlog.Config</li>
</ul>
<p>要同時輸出至Console，在config加上target與rule：</p>
<pre><code class="xml">&lt;target xsi:type=&quot;Console&quot; name=&quot;console&quot; layout=&quot;${message}&quot;  /&gt;
&lt;logger name=&quot;*&quot; minlevel=&quot;Debug&quot; writeTo=&quot;console&quot; /&gt;
</code></pre>

<p>加入顯示timestamp的layout:</p>
<pre><code class="xml">&lt;variable name=&quot;msgd&quot; value=&quot;${longdate} - ${message}&quot;/&gt;
</code></pre>

<p>記得layout要改成下變數</p>
<pre><code class="xml">&lt;target xsi:type=&quot;Console&quot; name=&quot;console&quot; layout=&quot;${msgd}&quot;  /&gt;
</code></pre>

<h2 id="systemservicemodel-configuration">System.ServiceModel Configuration</h2>
<pre><code class="xml">&lt;configuration&gt;  
    &lt;system.serviceModel&gt;  
        &lt;bindings&gt;  
        &lt;/bindings&gt;  
        &lt;services&gt;  
        &lt;/services&gt;  
        &lt;behaviors&gt;  
        &lt;/behaviors&gt;  
        &lt;client&gt;
        &lt;/client&gt;
    &lt;/system.serviceModel&gt;  
&lt;/configuration&gt;  
</code></pre>

<ul>
<li>services和client可以設定各種endpoint</li>
<li>Endpoints provide the clients access to the functionality that a WCF service offers</li>
<li>address:indicates where to find the endpoint</li>
<li>binding:specifies how a client can communicate with the endpoint</li>
<li>contract:identifies the methods available(其實重點只有這個，contract就是對應的程式端，出現mutiple endpoint error先檢查這個是不是重複)</li>
<li>binding用來設定傳輸(HTTP, TCP, pipes, Message Queuing)和協定(Security, Reliability, Transaction flows)，分為自訂的跟預設的，預設參考：<a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/system-provided-bindings">https://docs.microsoft.com/en-us/dotnet/framework/wcf/system-provided-bindings</a></li>
<li>bindingconfiguration對應binding裡面的name</li>
</ul>
<h2 id="configs">Configs</h2>
<h3 id="user-vs-application-scope">User vs Application scope</h3>
<p>偷換conifg value：</p>
<pre><code class="c#">BWStorage.MasterSettings.Default.PropertyValues[&quot;DB_ConnectionString&quot;].PropertyValue = DBManager.Read_DBConnectionStringWithDataBase(&quot;bwstorageoption&quot;);
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../C%23%20Garbage%20Collection/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../C%23%20Garbage%20Collection/" class="btn btn-xs btn-link">
        C# Garbage Collection
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../../Information%20Security/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../../Information%20Security/" class="btn btn-xs btn-link">
        Information Security
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>